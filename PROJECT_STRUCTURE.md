# 📊 PL AI Dashboard 프로젝트 구조

## 🎯 프로젝트 개요

이 프로젝트는 **F&F 그룹의 브랜드별 매출 데이터를 분석**하여 AI(Claude)가 자동으로 인사이트를 생성하는 도구입니다.

```
┌─────────────────────────────────────────────────────────┐
│                    사용자가 실행                         │
│              python pl_analysis.py                       │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  1️⃣ 데이터베이스에서 데이터 가져오기                    │
│     (Snowflake DB)                                      │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  2️⃣ AI에게 데이터 분석 요청                             │
│     (Claude API)                                        │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  3️⃣ 분석 결과를 파일로 저장                             │
│     (JSON + Markdown)                                   │
└─────────────────────────────────────────────────────────┘
```

---

## 📁 폴더 구조

```
PL_AI_DASHBOARD/
│
├── 📄 pl_analysis.py          ⭐ 메인 파일 (여기서 실행!)
│   └── 모든 분석 로직이 여기에 있음
│
├── 📁 analyzers/              (선택사항 - 현재 미사용)
│   ├── brand_analyzer.py      - 브랜드 분석기
│   ├── channel_sales_analyzer.py - 채널 매출 분석기
│   └── cost_analyzer.py       - 비용 분석기
│
├── 📁 config/                 (선택사항 - 현재 미사용)
│   └── sql_queries.py         - SQL 쿼리 모음
│
├── 📁 core/                   (선택사항 - 현재 미사용)
│   ├── base_analyzer.py       - 기본 분석 클래스
│   ├── file_manager.py        - 파일 관리
│   └── llm_client.py          - AI 클라이언트
│
├── 📁 utils/                  (선택사항 - 현재 미사용)
│   └── data_processor.py      - 데이터 처리 유틸리티
│
├── 📁 output/                 📤 결과 파일 저장 폴더
│   ├── json/                  - JSON 형식 결과
│   │   ├── 4-1-1-1.M_채널별_매출_top3_분석.json
│   │   ├── 4-1-1-2.M_채널별_매출_종합분석.json
│   │   ├── 4-1-3-1.M_성별_구매패턴_분석.json
│   │   └── 6-1-1-1.M_광고선전비_추이분석.json
│   │
│   └── md/                    - Markdown 형식 결과
│       ├── 4-1-1-1.M_채널별_매출_top3_분석.md
│       ├── 4-1-1-2.M_채널별_매출_종합분석.md
│       ├── 4-1-3-1.M_성별_구매패턴_분석.md
│       └── 6-1-1-1.M_광고선전비_추이분석.md
│
├── 📄 requirements.txt        - 필요한 라이브러리 목록
├── 📄 README.md               - 사용 설명서
└── 📄 .env                    - 환경 변수 (비밀번호 등)
```

---

## 🔄 데이터 흐름도

```
┌──────────────┐
│  사용자 설정  │
│ yyyymm, brd_cd│
└──────┬───────┘
       │
       ▼
┌─────────────────────────────────────┐
│   pl_analysis.py (메인 파일)        │
│                                     │
│  ┌──────────────────────────────┐  │
│  │ 1. 분석 함수 선택             │  │
│  │    - analyze_channel_sales() │  │
│  │    - analyze_gender_...()    │  │
│  │    - analyze_ad_expense()    │  │
│  └──────────┬───────────────────┘  │
│             │                       │
│  ┌──────────▼───────────────────┐  │
│  │ 2. SQL 쿼리 실행              │  │
│  │    get_xxx_query()            │  │
│  │    ↓                          │  │
│  │    Snowflake DB               │  │
│  └──────────┬───────────────────┘  │
│             │                       │
│  ┌──────────▼───────────────────┐  │
│  │ 3. 데이터 가공                │  │
│  │    - 요약 통계 계산           │  │
│  │    - TOP 3 아이템 추출        │  │
│  └──────────┬───────────────────┘  │
│             │                       │
│  ┌──────────▼───────────────────┐  │
│  │ 4. AI 분석 요청               │  │
│  │    call_llm(prompt)           │  │
│  │    ↓                          │  │
│  │    Claude API                 │  │
│  └──────────┬───────────────────┘  │
│             │                       │
│  ┌──────────▼───────────────────┐  │
│  │ 5. 결과 저장                  │  │
│  │    save_json()                │  │
│  │    save_markdown()            │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
       │
       ▼
┌──────────────┐
│ output/ 폴더 │
│  - JSON 파일 │
│  - MD 파일   │
└──────────────┘
```

---

## 📋 주요 파일 설명

### ⭐ pl_analysis.py (메인 파일)
**역할**: 모든 분석을 실행하는 핵심 파일

**구성**:
1. **설정 부분** (상단)
   - 브랜드 코드 매핑 (M=MLB, X=DISCOVERY 등)
   - 출력 폴더 경로

2. **DB 연결 함수**
   - `get_db_engine()`: Snowflake 데이터베이스 연결

3. **SQL 쿼리 함수들**
   - `get_channel_sales_cypy_query()`: 채널별 매출 (당해/전년 비교)
   - `get_channel_sales_query()`: 채널별 매출 (12개월 추이)
   - `get_gender_purchase_pattern_query()`: 성별 구매 패턴
   - `get_ad_expense_detail_query()`: 광고비 상세

4. **분석 함수들**
   - `analyze_channel_sales()`: 채널별 TOP3 매출 분석 (4-1-1-1)
   - `analyze_channel_sales_overall()`: 채널별 종합 분석 (4-1-1-2)
   - `analyze_gender_purchase_pattern()`: 성별 구매 패턴 (4-1-3-1)
   - `analyze_ad_expense()`: 광고선전비 추이 (6-1-1-1)

5. **실행 부분** (맨 아래)
   ```python
   if __name__ == '__main__':
       yyyymm = '202509'  # 분석할 년월
       brd_cd = 'M'       # 브랜드 코드
       
       # 원하는 분석만 주석 해제
       analyze_channel_sales(yyyymm, brd_cd)
   ```

---

## 🔍 각 분석 함수의 동작 과정

### 예시: `analyze_channel_sales()` 함수

```
1️⃣ 시작
   └─> "채널별 매출 분석 시작" 출력

2️⃣ 데이터베이스 연결
   └─> get_db_engine()

3️⃣ 분석 기간 계산
   └─> 당해: 2025년 9월
   └─> 전년: 2024년 9월

4️⃣ SQL 쿼리 실행
   └─> get_channel_sales_cypy_query()
   └─> Snowflake DB에서 데이터 가져오기

5️⃣ 데이터 가공
   ├─> 총 매출액 계산
   ├─> 채널별 요약 생성
   ├─> 채널별 TOP 3 아이템 추출
   └─> 당해/전년 비교 데이터 생성

6️⃣ AI 분석 요청
   └─> 프롬프트 작성
   └─> call_llm() → Claude API 호출
   └─> AI가 분석 결과 생성

7️⃣ 결과 저장
   ├─> JSON 파일 저장 (output/json/)
   └─> Markdown 파일 저장 (output/md/)

8️⃣ 완료
   └─> "[OK] 분석 완료!" 출력
```

---

## 📊 분석 종류별 설명

### 1. 채널별 TOP3 매출 분석 (4-1-1-1)
- **목적**: 각 채널별로 매출이 높은 상위 3개 아이템을 전년과 비교
- **입력**: 당해/전년 동월 데이터
- **출력**: 채널별 TOP3 아이템과 전년 대비 변화율

### 2. 채널별 매출 종합분석 (4-1-1-2)
- **목적**: 채널별 매출의 12개월 추이 분석
- **입력**: 최근 12개월 데이터
- **출력**: 월별 추이와 트렌드 분석

### 3. 성별 구매 패턴 분석 (4-1-3-1)
- **목적**: 남성/여성/공용 제품별 구매 패턴 분석
- **입력**: 당해/전년 동월 성별 구매 데이터
- **출력**: 성별별 선호 제품과 변화 추이

### 4. 광고선전비 추이 분석 (6-1-1-1)
- **목적**: 광고비 투자 효율성 분석
- **입력**: 당해/전년 동월 광고비 데이터
- **출력**: 광고비 변화와 최적화 방안

---

## 🛠️ 사용 방법 (초보자용)

### 1단계: 설정 파일 준비
`.env` 파일에 데이터베이스 정보와 AI API 키 입력

### 2단계: 분석할 내용 선택
`pl_analysis.py` 파일 맨 아래에서 원하는 분석 주석 해제:
```python
analyze_channel_sales(yyyymm, brd_cd)  # 이 줄의 # 제거
```

### 3단계: 실행
```bash
python pl_analysis.py
```

### 4단계: 결과 확인
`output/` 폴더에서 결과 파일 확인
- JSON: 데이터 구조화된 형식
- Markdown: 읽기 쉬운 문서 형식

---

## 💡 핵심 개념 설명

### SQL 쿼리
- **역할**: 데이터베이스에서 필요한 데이터를 가져오는 명령어
- **예시**: "2025년 9월 MLB 브랜드의 채널별 매출 데이터를 가져와줘"

### AI 프롬프트
- **역할**: AI에게 분석을 요청하는 지시문
- **예시**: "이 데이터를 보고 채널별 TOP3 아이템의 전년 대비 변화를 분석해줘"

### JSON 파일
- **역할**: 데이터를 구조화해서 저장하는 형식
- **용도**: 다른 프로그램에서 읽어서 사용 가능

### Markdown 파일
- **역할**: 사람이 읽기 쉬운 문서 형식
- **용도**: 보고서나 문서로 바로 사용 가능

---

## 🔗 파일 간 관계도

```
pl_analysis.py (메인)
    │
    ├─> get_db_engine() ──────> Snowflake DB
    │
    ├─> get_xxx_query() ──────> SQL 쿼리 생성
    │
    ├─> run_query() ──────────> 데이터 가져오기
    │
    ├─> call_llm() ───────────> Claude API
    │
    ├─> save_json() ──────────> output/json/
    │
    └─> save_markdown() ──────> output/md/
```

---

## 📝 현재 사용 중인 구조

**✅ 실제 사용 중:**
- `pl_analysis.py` - 모든 기능이 여기에 통합됨

**❌ 현재 미사용 (나중에 확장용):**
- `analyzers/` - 모듈화된 분석기들
- `config/` - SQL 쿼리 모음
- `core/` - 공통 기능들
- `utils/` - 유틸리티 함수들

**💡 참고**: 현재는 `pl_analysis.py` 하나로 모든 분석을 수행합니다.
다른 폴더들은 향후 확장을 위해 준비된 구조입니다.

