# analyze_channel_sales_overall 함수 프로세스 플로우

## 가로 플로우차트 (한 줄 흐름)

```
[시작] → [DB연결] → [기간계산] → [SQL실행] → [데이터조회] → [데이터분리] → [통계계산] → [채널집계] → [아이템추출] → [유효채널필터] → [프롬프트생성] → [LLM호출] → [응답처리] → [JSON구성] → [파일저장] → [종료]
```

## 상세 가로 플로우차트

```
┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐
│ 시작 │──▶│ DB  │──▶│ 기간 │──▶│ SQL │──▶│ 조회 │──▶│ 분리 │──▶│ 통계 │
│      │   │연결 │   │계산  │   │실행 │   │      │   │      │   │계산  │
└──────┘   └──────┘   └──────┘   └──────┘   └──────┘   └──────┘   └──────┘
                                                                      │
┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐      │
│ 채널 │◀──│ 집계 │◀──│ 아이템│◀──│ 필터 │◀──│ 프롬 │◀──│ LLM │◀─────┘
│집계  │   │      │   │추출  │   │      │   │프트  │   │호출  │
└──────┘   └──────┘   └──────┘   └──────┘   └──────┘   └──────┘
   │
   ▼
┌──────┐   ┌──────┐   ┌──────┐
│ 응답 │──▶│ JSON │──▶│ 저장 │──▶[종료]
│처리  │   │구성  │   │      │
└──────┘   └──────┘   └──────┘
```

## 단계별 상세 가로 플로우

### Phase 1: 데이터 수집
```
[함수시작] ──▶ [DB연결] ──▶ [기간계산: yyyymm → yyyymm_py] ──▶ [SQL쿼리실행] ──▶ [DataFrame조회]
```

### Phase 2: 데이터 전처리
```
[데이터조회] ──▶ [당해/전년분리] ──▶ [기본통계계산] ──▶ [채널별집계] ──▶ [상위아이템추출] ──▶ [유효채널필터링]
```

### Phase 3: AI 분석
```
[유효채널] ──▶ [프롬프트생성] ──▶ [LLM호출(Claude)] ──▶ [응답파싱] ──▶ [JSON구조생성]
```

### Phase 4: 결과 저장
```
[JSON구성] ──▶ [JSON파일저장] ──▶ [Markdown파일저장] ──▶ [DB종료] ──▶ [완료]
```

## 단계별 상세 설명

### 📊 **Phase 1: 초기화 및 데이터 수집**
```
[함수 시작] → [DB 연결] → [기간 계산] → [SQL 실행] → [데이터 조회]
```

### 🔄 **Phase 2: 데이터 전처리**
```
[데이터 분리] → [통계 계산] → [채널별 집계] → [아이템 추출] → [유효 채널 필터링]
```

### 🤖 **Phase 3: AI 분석**
```
[프롬프트 생성] → [LLM 호출] → [응답 처리] → [JSON 파싱]
```

### 💾 **Phase 4: 결과 저장**
```
[JSON 구성] → [파일 저장 (JSON/MD)] → [정리 및 종료]
```

## 데이터 흐름

```
원본 데이터 (SQL)
    │
    ├─▶ 당해 데이터 ──┐
    │                 │
    └─▶ 전년 데이터 ──┤
                      │
                      ▼
              채널별 집계
                      │
                      ├─▶ channel_summary
                      │   - current_sales
                      │   - previous_sales
                      │   - change_pct
                      │   - top_items
                      │
                      └─▶ valid_channels
                              │
                              ▼
                        LLM 프롬프트
                              │
                              ▼
                        LLM 분석 결과
                              │
                              ▼
                        최종 JSON/MD 파일
```

## 주요 데이터 구조

### channel_summary 구조
```json
{
  "채널명": {
    "current_sales": 1234.56,    // 당해 매출 (백만원)
    "previous_sales": 1000.00,  // 전년 매출 (백만원)
    "change_pct": 23.5,          // 변화율 (%)
    "top_items": [               // 상위 5개 아이템
      {
        "class3": "아이템명",
        "total_sales": 500.00
      }
    ]
  }
}
```

### 최종 JSON 구조
```json
{
  "brand_cd": "M",
  "brand_name": "MLB",
  "yyyymm": "202510",
  "yyyymm_py": "202410",
  "analysis_data": {
    "title": "...",
    "sections": [
      {
        "div": "채널명",
        "sub_title": "...",
        "ai_text": "..."
      }
    ]
  },
  "summary": {...},
  "channel_summary": {...},
  "raw_data": {...}
}
```

